#!/bin/sh
set -euo pipefail

git submodule update --init --recursive

# Install Abra cli to Cargo bin
cargo install --bin abra --path cli

# Install Vim syntax highlighting if ~/.vim exists
VIM_DIR="$HOME/.vim"
TARGET_DIR="$VIM_DIR/syntax"
SOURCE_FILE="./tooling/abra.vim"
TARGET_FILE="$TARGET_DIR/abra.vim"
if [ -d "$VIM_DIR" ]; then
  mkdir -p $VIM_DIR/syntax
  mkdir -p $VIM_DIR/ftdetect
  cp ./tooling/vim/syntax.vim $VIM_DIR/syntax/abra.vim
  cp ./tooling/vim/ftdetect.vim $VIM_DIR/ftdetect/abra.vim
fi

#!/bin/bash

install_abra_vscode_extension() {
    # Check if `code` (VS Code) is installed
    if ! command -v code &> /dev/null; then
        echo "'code' command not found. Skipping VS Code Abra extension installation."
        return 0
    fi

    echo "Installing VS Code extension 'undefined_publisher.abra'..."

    # Install the vsce package globally if not already installed
    if ! command -v vsce &> /dev/null; then
        npm install -g @vscode/vsce
    fi

    # Clone the repository and package the extension
    pushd tooling/vscode
    vsce package --allow-missing-repository

    # Install the packaged extension
    code --install-extension abra-0.0.1.vsix

    # Clean up
    popd
    rm -rf abra-syntax
}

# Call the function (you can remove this line if calling from another script)
install_abra_vscode_extension

